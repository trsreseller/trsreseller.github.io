<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Reseller Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f4f6f8;padding:15px}
.box{background:#fff;padding:15px;border-radius:6px;margin-bottom:15px}
.order{border-bottom:1px solid #ddd;padding:6px 0}
</style>
</head>

<body>

<div class="box">
<h3>ðŸ‘¤ Reseller Info</h3>
<p>à¦¨à¦¾à¦®: <span id="name"></span></p>
<p>Status: <span id="status"></span></p>
<input id="link" readonly>
</div>

<div class="box">
<h3>ðŸ“¦ Orders</h3>
<div id="orders">Loading...</div>
<p><b>à¦®à§‹à¦Ÿ à¦†à¦¯à¦¼:</b> <span id="earn">0</span> à¦Ÿà¦¾à¦•à¦¾</p>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDmpfADp5fHzKhifMmhKPMQAwjCSd_QQs0",
  authDomain: "trs-reseller.firebaseapp.com",
  projectId: "trs-reseller"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.firestore();

auth.onAuthStateChanged(u=>{
  if(!u){location.href="reseller-login.html";return;}

  db.collection("resellers").doc(u.uid).get().then(d=>{
    let r=d.data();
    name.innerText=r.name;
    status.innerText=r.status;
    link.value="https://trsreseller.github.io/order.html?ref="+r.resellerId;
  });

  let total=0;
  db.collection("orders").where("resellerId","!=", "")
  .onSnapshot(s=>{
    let h="";
    s.forEach(d=>{
      let o=d.data();
      if(o.status=="Delivered") total+=o.commission;
      h+=`<div class="order">${o.product} (${o.status})</div>`;
    });
    orders.innerHTML=h||"No orders";
    earn.innerText=total;
  });
});
</script>

</body>
</html>
