<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>TRS Reseller</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f2f2f2}
header{background:#0f172a;color:#fff;padding:12px}
header h1{margin:0;font-size:18px}
header p{margin:4px 0 0;font-size:13px;color:#cbd5e1}

.topbar{
  display:flex;gap:10px;overflow-x:auto;
  background:#fff;padding:10px;border-bottom:1px solid #ddd
}
.topbar span{
  background:#e5e7eb;padding:6px 12px;
  border-radius:20px;font-size:13px;white-space:nowrap
}

.section{padding:10px}
.products{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px
}

.card{
  background:#fff;border-radius:8px;
  overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1)
}
.card img{
  width:100%;height:160px;object-fit:cover
}
.card .info{
  padding:8px;font-size:14px
}
.card .name{
  font-weight:bold;margin-bottom:4px
}
.price{
  color:#dc2626;font-weight:bold
}
.lock{
  color:#6b7280;font-size:12px
}

@media(min-width:768px){
  .products{grid-template-columns:repeat(4,1fr)}
}
</style>
</head>

<body>

<header>
  <h1>TRS Reseller</h1>
  <p>Wholesale Platform for Approved Resellers</p>
</header>

<!-- CATEGORY BAR -->
<div class="topbar" id="categoryBar">
  Loading categories...
</div>

<!-- PRODUCT AREA -->
<div class="section">
  <div class="products" id="productBox">Loading products...</div>
</div>

<script>
/* ðŸ”¥ FIREBASE CONFIG â€” same as before */
firebase.initializeApp({
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT"
});

const auth = firebase.auth();
const db = firebase.firestore();

let approved=false;
let selectedCategory="";

/* ðŸ” CHECK LOGIN + APPROVAL */
auth.onAuthStateChanged(async user=>{
  if(user){
    const snap=await db.collection("resellers").doc(user.uid).get();
    if(snap.exists && snap.data().approved===true){
      approved=true;
    }
  }
  loadCategories();
});

/* ðŸ—‚ï¸ LOAD CATEGORIES */
async function loadCategories(){
  const bar=document.getElementById("categoryBar");
  bar.innerHTML="";
  const snap=await db.collection("categories").get();

  snap.forEach(doc=>{
    const name=doc.data().name;
    if(!selectedCategory) selectedCategory=name;

    const span=document.createElement("span");
    span.innerText=name;
    span.onclick=()=>{
      selectedCategory=name;
      loadProducts();
    };
    bar.appendChild(span);
  });

  loadProducts();
}

/* ðŸ“¦ LOAD PRODUCTS */
async function loadProducts(){
  const box=document.getElementById("productBox");
  box.innerHTML="Loading...";

  const snap=await db.collection("products")
    .where("category","==",selectedCategory)
    .get();

  box.innerHTML="";

  snap.forEach(doc=>{
    const p=doc.data();
    box.innerHTML+=`
      <div class="card">
        <a href="product.html?id=${doc.id}">
          <img src="${p.images[0]}">
        </a>
        <div class="info">
          <div class="name">${p.name}</div>
          ${
            approved
            ? `<div class="price">à§³ ${p.price}</div>`
            : `<div class="lock">ðŸ”’ Login & approved reseller only</div>`
          }
        </div>
      </div>
    `;
  });
}
</script>

</body>
</html>
