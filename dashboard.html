<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>TRS Reseller Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{font-family:Arial;background:#f4f6f8;padding:10px}
.box{background:#fff;padding:15px;border-radius:6px;margin-bottom:15px}
input,select,textarea,button{width:100%;padding:10px;margin:6px 0}
button{background:#007bff;color:#fff;border:none;border-radius:4px}
.del{background:#dc3545}
.card{border-bottom:1px solid #ddd;padding:8px 0}
small{color:#666}
h3{margin-top:0}
</style>
</head>

<body>

<h2>ðŸ“Š TRS Reseller Admin Dashboard</h2>

<!-- CATEGORY -->
<div class="box">
<h3>ðŸ“‚ Category</h3>
<input id="catname" placeholder="Category name">
<button onclick="addCategory()">Add Category</button>
<div id="catlist"></div>
</div>

<!-- PRODUCT -->
<div class="box">
<h3>ðŸ“¦ Product</h3>
<input id="pname" placeholder="Product name">
<input id="price" placeholder="Price">
<select id="pcat"></select>
<textarea id="imgs" placeholder="Image URLs (comma separated)"></textarea>
<input id="video" placeholder="YouTube video URL (optional)">
<button onclick="addProduct()">Save Product</button>
</div>

<!-- ORDERS -->
<div class="box">
<h3>ðŸ§¾ Orders</h3>
<div id="orders">Loading...</div>
</div>

<!-- WITHDRAW -->
<div class="box">
<h3>ðŸ’° Withdraw Requests</h3>
<div id="withdraws">Loading...</div>
</div>

<script>
/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyDmpfADp5fHzKhifMmhKPMQAwjCSd_QQs0",
  authDomain: "trs-reseller.firebaseapp.com",
  projectId: "trs-reseller"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
firebase.auth().onAuthStateChanged(u=>{
  if(!u){location.href="login.html";}
});

/* CATEGORY */
function addCategory(){
  if(!catname.value)return alert("Category required");
  db.collection("categories").add({
    name:catname.value,time:new Date()
  }).then(()=>location.reload());
}

db.collection("categories").orderBy("time","desc")
.onSnapshot(s=>{
  let h="",opt="<option>Select category</option>";
  s.forEach(d=>{
    let c=d.data();
    h+=`<div class="card">${c.name}
    <button class="del" onclick="delCat('${d.id}')">X</button></div>`;
    opt+=`<option>${c.name}</option>`;
  });
  catlist.innerHTML=h;
  pcat.innerHTML=opt;
});

function delCat(id){
  if(confirm("Delete category?"))
  db.collection("categories").doc(id).delete();
}

/* PRODUCT */
function addProduct(){
  if(!pname.value||!price.value||!pcat.value)
  return alert("Missing info");
  db.collection("products").add({
    name:pname.value,
    price:price.value,
    category:pcat.value,
    images:imgs.value.split(","),
    video:video.value,
    time:new Date()
  }).then(()=>{
    alert("Product saved");
    pname.value=price.value=imgs.value=video.value="";
  });
}

/* ORDERS */
db.collection("orders").orderBy("time","desc")
.onSnapshot(s=>{
  let h="";
  s.forEach(d=>{
    let o=d.data();
    h+=`<div class="card">
    <b>${o.product}</b><br>
    ${o.name} | ${o.phone}<br>
    Qty: ${o.quantity}
    </div>`;
  });
  orders.innerHTML=h||"No orders";
});

/* WITHDRAW */
db.collection("withdraws").orderBy("time","desc")
.onSnapshot(s=>{
  let h="";
  s.forEach(d=>{
    let w=d.data();
    h+=`<div class="card">
    ${w.name} - à§³${w.amount}
    </div>`;
  });
  withdraws.innerHTML=h||"No requests";
});
</script>

</body>
</html>
